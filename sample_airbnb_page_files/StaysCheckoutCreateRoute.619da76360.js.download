__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function s(){const t=r(d[1]);return s=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=t(r(d[2])),n=r(d[3]),h=r(d[4]);const l=new class{constructor(){this.history=void 0,this.historyCallback=void 0,this.lastLoggedPathname=void 0,this.unlistenHistory=void 0,this.isClientRouteRequest=!1,this.history=void 0,this.unlistenHistory=void 0,this.historyCallback=void 0,this.lastLoggedPathname=void 0}setHistoryListener(t,s){this.history||(this.history=t,this.unlistenHistory=t.listen(this.onHistoryChange.bind(this)),void 0===this.lastLoggedPathname&&this.history.location&&(this.lastLoggedPathname=this.history.location.pathname)),s&&s!==this.historyCallback&&(this.historyCallback=s)}onHistoryChange(t,s){this.isClientRouteRequest=!0,this.historyCallback&&this.historyCallback(t,s)}logImpression({universalPageName:t,subpageName:l,eventData:u,eventDataSchema:c,impressionUuid:v,pageRequestMethod:y,processingContext:p}){(0,h.getPageRequestMethod)(this.isClientRouteRequest).then((h=>{const P={schema:s().UniversalPageImpressionEvent,event_data:{page_name:t,subpage_name:l,referrer:document.referrer||'unknown',page_request_method:y||h,event_data:u,event_data_schema:c,impression_uuid:v,navigation_type:(0,n.getNavigationType)(),url:document.location.href,...p??{}}};o.default.logJitneyEvent(P)}))}hasMovedToNewPage(t,s,o){return'POP'===s||'PUSH'===s||!!o&&'REPLACE'===s&&t.pathname!==this.lastLoggedPathname}};e.default=l}),"007d44",["ba7a76","bf254a","c8b97a","5d602b","6f10f0"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(...t){if(!t.length)throw new Error('withPagePerformanceScore: You must supply universalPageName.');const{buildEventDataFromProps:I,eventDataSchema:D,trackReplaceNavigationsToNewPathnames:C=!1,universalPageName:b,subPageName:T,deprecatedIgnorePathnameUpdateForImpressions:x,ignorePathnameUpdate:A,includeHistoryUpdate:L}=E(t);if('function'==typeof I&&!D)throw new Error('withPagePerformanceScore: You must supply an event data schema if you supply an event data function.');return function(t){class E extends n.Component{constructor(t){super(t),this.bootstrappedApiLoggingContext=void 0,this.evaluatedEventDataSchema=void 0,this.evaluatedUniversalPageName=void 0,this.evaluatedSubPageName=void 0,this.eventDataSchema=void 0,this.impressionUuid=void 0,this.isInPageTransition=void 0,this.pageTransitionAcknowledgedByRender=void 0,this.previousPathname=void 0,this.lastLoggedPathname=void 0,this.deprecatedIgnorePathnameUpdateForImpressions=void 0,this.timeout=void 0,this.timestampOfInteractivity=void 0,this.ttfcpRequestAnimationFrameId=void 0,this.ignorePathnameUpdate=void 0,this.includeHistoryUpdate=void 0,this.onPageShow=t=>{t.persisted&&this.handlePageTransition()},this.getEvaluatedUniversalPageNames=()=>({evaluatedUniversalPageName:(0,w.evaluateUniversalPageName)(b,this.props),evaluatedSubPageName:T&&(0,w.evaluateSubpageName)(T,this.props)}),this.shouldSkipImpressionLogging=()=>{const{history:t}=this.props;return'function'==typeof this.deprecatedIgnorePathnameUpdateForImpressions&&t&&t.location&&this.lastLoggedPathname&&this.deprecatedIgnorePathnameUpdateForImpressions({prevPathname:this.lastLoggedPathname,nextPathname:t.location.pathname})},this.handleNewPageMount=()=>{const{history:t}=this.props,n=(0,N.updateJitneyClientSession)();l.default.addContext({client_session_id:n}),(0,p.storePageName)(window.document.URL,this.evaluatedUniversalPageName);const s=this.generateEventData(),o=(0,v.extractProcessingContextFromEventData)(I);this.shouldSkipImpressionLogging()||(l.default.setImpressionMetadata({eventDataSchema:this.evaluatedEventDataSchema,initialEventData:s,impressionUuid:this.impressionUuid}),P.default.logImpression({universalPageName:this.evaluatedUniversalPageName,subpageName:this.evaluatedSubPageName,eventData:s,eventDataSchema:this.evaluatedEventDataSchema,impressionUuid:this.impressionUuid,processingContext:o}),this.lastLoggedPathname=t&&t.location&&t.location.pathname),t&&P.default.setHistoryListener(t,((t,n)=>{if(P.default.hasMovedToNewPage(t,n,C)){if(this.pageTransitionAcknowledgedByRender)return void(this.pageTransitionAcknowledgedByRender=!1);this.isInPageTransition=!0}else(0,p.storePageName)(window.document.URL,this.evaluatedUniversalPageName)})),this.ttfcpRequestAnimationFrameId=requestAnimationFrame((()=>{const t={universalPageName:this.evaluatedUniversalPageName,subPageName:this.evaluatedSubPageName,impressionUuid:this.impressionUuid,timestampOfFCP:(0,c.default)().now(),eventData:s,eventDataSchema:this.evaluatedEventDataSchema};U.default.updateCurrentRecorderWithHOCProps(t)})),'function'==typeof this.ignorePathnameUpdate&&U.default.setIgnorePathnameUpdate(this.ignorePathnameUpdate),'function'==typeof this.includeHistoryUpdate&&U.default.setIncludeHistoryUpdate(this.includeHistoryUpdate)},this.eventDataSchema=D;const{evaluatedUniversalPageName:n,evaluatedSubPageName:u}=this.getEvaluatedUniversalPageNames();this.evaluatedUniversalPageName=n,this.evaluatedSubPageName=u,this.evaluatedEventDataSchema=(0,w.evaluateEventDataSchema)(D,t),this.isInPageTransition=!1,this.timestampOfInteractivity=null,this.previousPathname=t.location&&t.location.pathname,this.pageTransitionAcknowledgedByRender=!1,this.impressionUuid=(0,s().v4)();const f=h.default.get('api_logging_context');if(this.bootstrappedApiLoggingContext=void 0,this.deprecatedIgnorePathnameUpdateForImpressions=x,this.ignorePathnameUpdate=A,this.includeHistoryUpdate=L,f)try{'object'==typeof f?this.bootstrappedApiLoggingContext=f:'string'==typeof f&&(this.bootstrappedApiLoggingContext=JSON.parse(f))}catch(t){l.default.logJitneyEvent({schema:o().ApiLoggingContextMalformedBootstrapDataEvent,event_data:{payload:f,impression_uuid:this.impressionUuid}})}this.handlePageTransition=this.handlePageTransition.bind(this),this.generateEventData=this.generateEventData.bind(this),this.setContextForPage=this.setContextForPage.bind(this),this.setContextForPage()}componentDidMount(){window.performance&&'function'==typeof window.performance.mark&&window.performance.mark(f.HYDRATE_PERFORMANCE_HOC_MARK),this.handleNewPageMount(),'addEventListener'in window&&window.addEventListener('pageshow',this.onPageShow)}componentWillUnmount(){this.timeout&&window.clearTimeout(this.timeout),'removeEventListener'in window&&window.removeEventListener('pageshow',this.onPageShow),this.ttfcpRequestAnimationFrameId&&cancelAnimationFrame(this.ttfcpRequestAnimationFrameId),U.default.clearIgnorePathnameUpdate(),U.default.clearIncludeHistoryUpdate()}setContextForPage(){(0,u.setPageName)(this.evaluatedUniversalPageName),l.default.addContext({page_name:this.evaluatedUniversalPageName,impression_uuid:this.impressionUuid}),S&&l.default.addContext({previous_page_name:S}),S=this.evaluatedUniversalPageName}handlePageTransition(){this.isInPageTransition=!1,this.previousPathname=this.props.location&&this.props.location.pathname,this.timestampOfInteractivity=null;const{evaluatedUniversalPageName:t,evaluatedSubPageName:n}=this.getEvaluatedUniversalPageNames();this.evaluatedUniversalPageName=t,this.evaluatedSubPageName=n,this.evaluatedEventDataSchema=(0,w.evaluateEventDataSchema)(D,this.props),this.impressionUuid=(0,s().v4)(),this.setContextForPage(),l.default.setImpressionMetadata({eventDataSchema:this.evaluatedEventDataSchema,initialEventData:this.generateEventData(),impressionUuid:this.impressionUuid}),this.handleNewPageMount()}generateEventData(){const t='function'==typeof I?I(this.props):{};if(t||this.bootstrappedApiLoggingContext)return{...t,...this.bootstrappedApiLoggingContext}}render(){const{history:n,location:s}=this.props;return this.isInPageTransition&&this.handlePageTransition(),s&&n&&this.previousPathname!==s.pathname&&(this.previousPathname=s.pathname,P.default.hasMovedToNewPage(s,n.action,C)?(this.handlePageTransition(),this.pageTransitionAcknowledgedByRender=!0):(0,p.storePageName)(window.document.URL,this.evaluatedUniversalPageName)),(0,y.jsx)(t,{...this.props})}}return E.propTypes={...t.propTypes},E.defaultProps={...t.defaultProps},E.displayName=`withPagePerformanceScore(${t.displayName||t.name||'Component'})`,E}};t(r(d[1]));var n=r(d[2]);function s(){const t=r(d[3]);return s=function(){return t},t}function o(){const t=r(d[4]);return o=function(){return t},t}var h=t(r(d[5])),u=r(d[6]),p=r(d[7]),l=t(r(d[8])),v=r(d[9]),c=t(r(d[10])),P=t(r(d[11])),f=r(d[12]),U=t(r(d[13])),N=r(d[14]),w=r(d[15]),y=r(d[16]);let S;function E(t){return 1===t.length?t[0]:{...t[0],...t[1]}}}),"3a6fa9",["ba7a76","29c0a5","07aa1f","305dd5","de621c","ef2bc3","33392f","861735","c8b97a","cfab2c","5d602b","007d44","364f02","5c13fa","82f976","f85727","b8c07d"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.updateCache=void 0;var n=t(r(d[1])),o=r(d[2]);const u=(t,n)=>{if(n&&t?.paymentDataRequest){const u=JSON.parse(t.paymentDataRequest),s=JSON.stringify((0,o.convertToStableObjectOrder)({...u,bill_info:{...u?.bill_info,bill_item_product_id:n}}));return{...t,paymentDataRequest:s}}return t};e.updateCache=({proxy:t,stayCheckout:o,variables:s})=>{const c=o?.sections?.metadata?.confirmationCode||void 0,p=u(s?.input?.quickPayData,c),l={input:{...s.input,confirmationCode:c,quickPayData:p}};t.unsafe__writeQuery({query:n.default,variables:l,data:{presentation:{__typename:'RootPresentationContainer',stayCheckout:o}}})}}),"5c0dc9",["ba7a76","db1041","735391"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function n(){const t=r(d[1]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.updateJitneyClientSession=v;var o=t(r(d[2])),s=t(r(d[3])),c=r(d[4]),_=t(r(d[5])),l=t(r(d[6]));let u=0,C=null,y=!1;function p(){return o.default.isTrebuchetLaunched((0,s.default)('web_tld_privacy_regions'))}function f(t){if(t-u<1800)return!0;const n=p(),{value:o,hadConsentRejected:s}=(0,c.getCookieSync)('jitney_client_session_id',{preConsentDataValue:!n}),_=(0,c.getCookieSync)('jitney_client_session_created_at',{preConsentDataValue:!n}).value,l=(0,c.getCookieSync)('jitney_client_session_updated_at',{preConsentDataValue:!n}).value;return s?(h(),!1):(C=o,o&&_&&l&&t-parseInt(_,10)<86400&&t-parseInt(l,10)<1800)}function j(t){const o=(0,n().v4)(),s=p(),{hadConsentRejected:_,value:l}=(0,c.setCookieSync)('jitney_client_session_id',o,{preConsentDataValue:!s,path:'/'});(0,c.setCookieSync)('jitney_client_session_created_at',`${t}`,{preConsentDataValue:!s,path:'/'}),(0,c.setCookieSync)('jitney_client_session_updated_at',`${t}`,{preConsentDataValue:!s,path:'/'}),_?h():(u=t,C=l)}function k(t){requestIdleCallback((()=>{const n=p();(0,c.setCookieSync)('jitney_client_session_updated_at',`${t}`,{preConsentDataValue:!n,path:'/'})})),u=t}function v(){const t=(new Date).getTime()/1e3;return f(t)?k(t):j(t),y||(y=!0,p()&&(0,l.default)({toolName:'Airbnb Functional',onUpdateOnly:!0,doesCookieHaveConsentCb:()=>{const t=v();_.default.addContext({client_session_id:t})}})),C}function h(){u=0,C=null,y=!1,(0,c.deleteCookieAsync)('jitney_client_session_id'),(0,c.deleteCookieAsync)('jitney_client_session_created_at'),(0,c.deleteCookieAsync)('jitney_client_session_updated_at')}}),"82f976",["ba7a76","305dd5","dcc72a","2c6bf9","13babd","c8b97a","e8f252"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getPageName=function(t){return p=h(t),f(p)||(0,n.localStorageGetItem)(o+p,{fromAmplify:!0})||void 0;var p},e.storePageName=function(c,s){const u=h(c),l=f(u);if(!l)try{(0,n.localStorageSetItem)(o+u,s,{expires:p})}catch(n){const o=n instanceof Error?n:new Error(String(n));(0,t.warn)(o,{extra:{fromJitneyCache:!0,pageName:l},originalError:n instanceof Error?n:void 0})}};var t=r(d[0]),n=r(d[1]);const o='jitney_page_name_',p=36e5,c='[/#?]?$',s='[^/#?]+?',u=[{path:new RegExp(`/experiences/${s}${c}`),pageName:3003},{path:new RegExp(`/rooms/plus/${s}${c}`),pageName:3001},{path:new RegExp(`/rooms/${s}${c}`),pageName:3e3},{path:new RegExp(`/s/guidebooks${c}`),pageName:1006},{path:new RegExp(`/s/${s}${c}`),pageName:2e3}];function f(t){const n=u.find((({path:n})=>{const o=t.match(n);return o&&o[0]===t}));return n?n.pageName:null}function h(t){const{pathname:n}=new URL(t,'https://airbnb.com');return n}}),"861735",["f2f40f","13babd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,o=r(d[1]).default;function s(){const t=r(d[2]);return s=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.mutateSearchWithParams=$;var n=r(d[3]),u=r(d[4]),c=r(d[5]),f=o(r(d[6])),y=r(d[7]);function C(){const t=r(d[8]);return C=function(){return t},t}var l=t(r(d[9])),h=t(r(d[10])),p=r(d[11]),v=t(r(d[12])),k=t(r(d[13])),b=t(r(d[14])),_=r(d[15]),O=r(d[16]),P=r(d[17]),I=r(d[18]);function $({confirmationCode:t,orderId:o,params:n,staysData:u}){const f=k.default.current().curr,{numberOfGuests:y,guestCurrency:C}=n,l={...n,code:t,orderId:o,guestCurrency:C||f||void 0};if(!(void 0!==y||!u)){const{numberOfAdults:t,numberOfChildren:o,numberOfGuests:n,numberOfInfants:f,numberOfPets:y}=u||{},C={numberOfAdults:t??void 0,numberOfChildren:o??void 0,numberOfGuests:n??void 0,numberOfInfants:f??void 0,numberOfPets:y??void 0,...l};return(0,c.warn)('[Checkout][Stays] create route recovery flow triggered',{extra:{updatedParams:l,staysData:u}}),`?${(0,s().stringify)(C)}`}return`?${(0,s().stringify)(l)}`}const x=(0,l.default)({universalPageName:4003,includeHistoryUpdate:()=>!1})((({location:t,queryRef:o})=>{const c=(0,C().useNiobeClient)(),{search:l}=t,k=(0,n.useMemo)((()=>(0,y.coerceStaysCheckoutParams)((0,h.default)(l))),[l]),{productId:x}=k,D=(0,f.default)()===f.FORM_FACTOR.COMPACT,{data:M,error:R}=(0,C().usePreloadedQuery)({query:b.default,queryRef:o});return x||(0,O.reportStaysCheckoutInputError)(k,'StaysCheckoutCreateRoute_mutation'),(0,n.useEffect)((()=>{const t=M?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.staysData?.checkoutProductVersion||null;(0,u.airdogCount)('checkout.stays.route.first_render',1,{has_data:!!M,route:'stays_create_route',is_compact:D,checkout_prefetch_on_hover_v2:!D||'compact',product_version:t})}),[]),(0,n.useEffect)((()=>{if((R||M?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.errorCode||M?.presentation?.stayCheckout?.sections?.metadata?.errorData)&&(0,u.airdogCount)('stays_checkout.create_route.error',1,{errorCode:M?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.errorCode,niobeError:R?.message,hasRedirect:!!M?.presentation?.stayCheckout?.sections?.metadata?.errorData?.redirectUrl}),M?.presentation?.stayCheckout){const{stayCheckout:t}=M.presentation,o=t.sections?.metadata?.orderId||void 0,s=$({confirmationCode:t.sections?.metadata?.confirmationCode||void 0,orderId:o,params:k,staysData:t.sections?.stateMutation||void 0}),n=(0,P.getCheckoutPrepareMutationVariables)({params:{...k,orderId:o}});(0,_.updateCache)({proxy:c,stayCheckout:t,variables:n}),(0,p.replaceToHistory)(`/book/stays/${x}${s}`)}else{const t=`?${(0,s().stringify)(k)}`;(0,p.replaceToHistory)(`/book/stays/${x}${t}`)}}),[M,R,x,k,c]),(0,I.jsx)(v.default,{})}));e.default=x}),"8c3699",["ba7a76","45f788","e950a3","07aa1f","3e4681","f2f40f","e0b071","261c30","068abc","3a6fa9","a7c4ef","4ee5a9","f27cf8","06a99e","db1041","5c0dc9","0f60a4","80cc43","b8c07d"]);
__d((function(g,r,i,a,m,e,d){'use strict';Object.defineProperty(e,"__esModule",{value:!0});var t=e.ApiLoggingContextMalformedBootstrapDataEvent={defaultProps:{schema:'com.airbnb.jitney.event.logging.ApiLoggingContext:ApiLoggingContextMalformedBootstrapDataEvent:1.0.0',event_name:'apiloggingcontext_malformed_bootstrap_data'},propTypes:{}};t.fullyQualifiedName='ApiLoggingContext.v1.ApiLoggingContextMalformedBootstrapDataEvent',t.emissionDisabled=!0;e.ApiLoggingContextMalformedBootstrapDataEventEvent=function(o){return{eventData:o,eventDataSchema:t}}}),"de621c",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var o=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({toolName:o,doesCookieHaveConsentCb:E,onUpdateOnly:l}){if(!l){const t=(0,f.getConsentForTool)(o);E(t)}const u=()=>{const t=(0,f.getConsentForTool)(o);E(t)},_=()=>{E(!1)};return t.default.on(n.USER_LOGOUT_EVENT,_),t.default.on(n.CHECK_CONSENT_EVENT,u),()=>{t.default.off(n.USER_LOGOUT_EVENT,_),t.default.off(n.CHECK_CONSENT_EVENT,u)}};var t=o(r(d[1])),n=r(d[2]),f=r(d[3])}),"e8f252",["ba7a76","abc3e4","ea44e9","8b1591"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.evaluateEventDataSchema=function(t,n){if('object'==typeof t)return t;if('function'==typeof t){const u=t(n);if('object'!=typeof u&&void 0!==u)return;return u}return},e.evaluateSubpageName=function(t,n){if('function'==typeof t){return t(n)}return t},e.evaluateUniversalPageName=function(t,n){if('function'==typeof t){return t(n)}return t}}),"f85727",[]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/gp-stays-checkout-route/routes/StaysCheckoutRoute/StaysCheckoutCreateRoute.2d4548b0d6.js.map